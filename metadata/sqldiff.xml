<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqldiff PUBLIC "-//OpenMRS//DTD OpenMRS SQL Diff Config 1.0//EN" "http://resources.openmrs.org/doctype/sqldiff-1.0.dtd">

<sqldiff version="1.0">
	<help>
		USE:
			The diffs are ordered by datamodel version number.
			The script can be run in a top down fashion and is
			expected to not failor overwrite old data
		
		EXPECT:
			- "use business-database-name;" was called prior to
			   calling this script
	</help>
	
	<diff>
		<version>1.0</version>
		<author>Daniel Kayiwa</author>
		<date>Nov 8th 2007</date>
		<description>
			Creating the xform table to store XForm files
		</description>
		<sql>
		
		CREATE TABLE IF NOT EXISTS `xform` (
			  `form_id` int(11) NOT NULL,
			  `xform_data` text NOT NULL,
			  `creator` int(11) NOT NULL default '0',
			  `date_created` datetime NOT NULL default '0000-00-00 00:00:00',
			  PRIMARY KEY  (`form_id`),
			  KEY `User who created XForm` (`creator`),
			  KEY `Form with which this XForm is related` (`form_id`),
			  CONSTRAINT `User who created XForm` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8;
			
		insert into scheduler_task_config (name,description,schedulable_class, repeat_interval,start_time,created_by)
		values ('Process XForms Queue','Processes the XForms queue.','org.openmrs.module.xforms.ProcessXformsQueueTask',30,now(),(select min(user_id) from users));
		
		insert into scheduler_task_config (name,description,schedulable_class, repeat_interval,start_time,created_by)
		values ('XForms Bluetooth Task','Processes Bluetooth connection requests for XForms together with the corresponding user and patient downloads.','org.openmrs.module.xforms.bluetooth.XformsBluetoothTask',86400,now(),(select min(user_id) from users));
		
		insert into scheduler_task_config_property (name,value,task_config_id)
		values ('ServiceName','OpenMRS XForms Bluetooth Server',(select max(task_config_id) from scheduler_task_config) );
		
		insert into scheduler_task_config_property (name,value,task_config_id)
		values ('ServerUUID','F0E0D0C0B0A000908070605040301111',(select max(task_config_id) from scheduler_task_config) );
		
		insert into scheduler_task_config_property (name,value,task_config_id)
		values ('ServerIP','localhost',(select max(task_config_id) from scheduler_task_config) );
		
		insert into scheduler_task_config (name,description,schedulable_class, repeat_interval,start_time,created_by)
		values ('XForms SMS Task','Processes SMS connection requests for XForms together with the corresponding user and patient downloads.','org.openmrs.module.xforms.sms.XformsSMSTask',86400,now(),(select min(user_id) from users));

		insert into scheduler_task_config_property (name,value,task_config_id)
		values ('ModemPort','COM1',(select max(task_config_id) from scheduler_task_config) );
		
		insert into scheduler_task_config_property (name,value,task_config_id)
		values ('ServerPort','1234',(select max(task_config_id) from scheduler_task_config) );
		
		</sql>
	</diff>
	
	<diff>
		<version>1.1</version>
		<author>Daniel Kayiwa</author>
		<date>Jan 6th 2008</date>
		<description>
			Adding xslt column to the xform table.
		</description>
		<sql>
			alter table xform add column xslt mediumtext;	
		</sql>
	</diff>
	
	<diff>
		<version>1.2</version>
		<author>Daniel Kayiwa</author>
		<date>Jan 22nd 2008</date>
		<description>
			Adding more sms task config parameters.
		</description>
		<sql>
			
			insert into scheduler_task_config_property (name,value,task_config_id)
			values ('MsgSrcPort','1234',(select max(task_config_id) from scheduler_task_config) );
	
			insert into scheduler_task_config_property (name,value,task_config_id)
			values ('MsgDestPort','1234',(select max(task_config_id) from scheduler_task_config) );
	
			insert into scheduler_task_config_property (name,value,task_config_id)
			values ('ModemBaudRate','9600',(select max(task_config_id) from scheduler_task_config) );
	
			insert into scheduler_task_config_property (name,value,task_config_id)
			values ('ModemManufacturer','Nokia',(select max(task_config_id) from scheduler_task_config) );
	
			insert into scheduler_task_config_property (name,value,task_config_id)
			values ('ModemModel','6020',(select max(task_config_id) from scheduler_task_config) );
	
			insert into scheduler_task_config_property (name,value,task_config_id)
			values ('ModemId','OpenMRS SMS Gateway',(select max(task_config_id) from scheduler_task_config) );
	
			delete from scheduler_task_config_property where name='ServerPort';
			
		</sql>
	</diff>
	
</sqldiff>
